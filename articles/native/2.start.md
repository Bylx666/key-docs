# 开始

开一个新项目(新建文件夹随便起个名, `cd`进去, `cargo init`)

首先在你的项目中安装`key_native`模块: `cargo add key_native`

然后修改`Cargo.toml`, 在最后添加以下内容(让rust知道你在编译动态链接库, 否则会把你的项目视为可运行程序)

```toml
[lib]
crate-type = ["cdylib"]
```

接着把`main.rs`删掉, 新建一个`lib.rs`(是`cdylib`的要求).

最后在`lib.rs`中这样写: 

```rust
use key_native::prelude::*;

#[no_mangle]
fn main(m:&mut NativeModule) {
  println!("okk");
}
```

至此一切都配置完成了. 运行`cargo build`, 找到`target/debug/`, 里面会有一个`xxlib.dll`的文件, 就是你成功生成的原生模块了. 你可以在vscode中右键此文件, 点复制路径, 然后粘贴到一个`ks`文件中. 

假设你的目录是`d:\code\rust\keytest`, 那么你的`dll`文件应当是`d:\code\rust\keytest\target\debug\keytestlib.dll`. 那么在这个ks文件中:

```
mod d:\code\rust\keytest\target\debug\keytestlib.dll> my_mod;
```

用`key`命令运行这个脚本, 就能得到`okk`. 


